==============
Using Metadata
==============

Tools
-----

There are currently two tools you can use to set project metadata. The easiest
to use is the new web interface. Visit the "View/Edit Metadata" link on any stats
page and paste in your CIA key. You'll need a browser that supports SSL. A guide
to the supported key-value pairs is below.

The other method is stats_metadata.py, a tool included with the `CIA source`_.
It has fewer dependencies than the rest of CIA, but
you will need Python_ 2.2.1 or later and Twisted_.

To use either tool, you will need a capability key for CIA that grants
access to at least the metadata for one stats target. Currently you have to
ask Micah_ for such a key. Your key will be a 24-digit string of random
alphanumeric gibberish. The recommended place to keep it on UNIX-like
platforms is "~/.cia_key", since that's where the CIA tools look for it by
default. If you only plan on using the web-based tools, it doesn't matter.

The full usage text, as given by running
stats_metadata.py with no options, is::

 Usage: stats_metadata.py [options] path key [value]
 Options:
   -f, --from-file  The value specified is actually a file to read the value from
   -r, --remove     Remove the specified metadata key
   -s, --server=    The URI of the CIA server to connect to [default:
                    http://localhost:3910]
   -k, --key=       Load a capability key from this file [default: ~/.cia_key]
   -t, --type=      The MIME type to use when setting a key value [default:
                    text/plain]
       --version    
       --help       Display this help and exit.

Some sample use cases for a project named "pigomatic"::

 ./stats_metadata.py -s https://cia.navi.cx project/pigomatic url http://pig-o-matic.sf.net

 ./stats_metadata.py -s https://cia.navi.cx project/pigomatic title "Pig-O-Matic 2000"

 ./stats_metadata.py -s https://cia.navi.cx project/pigomatic description "Pig-O-Matic \
 is a next generation spam-powered flight simulator designed for the Super Nintendo and \
  Atari 2600 platforms."

 ./stats_metadata.py -s https://cia.navi.cx -f -t image/jpeg project/pigomatic photo pigs-on-the-wing.jpeg

 ./stats_metadata.py -s https://cia.navi.cx -f -t image/png project/pigomatic icon smiling-pig.png


.. _Micah: mailto:micah@navi.cx
.. _CIA source: http://svn.navi.cx/misc/trunk/cia
.. _Python: http://python.org
.. _Twisted: http://twistedmatrix.com


Supported key-value pairs
-------------------------

There's nothing stopping you from using any key/value pairs you want for your project's metadata,
but only a few key names are used by CIA for anything. This list is sorted roughly from most important
to least important:

* title

    By default the displayed name of a stats target is the same as the last component
    of its path. For example, the target at project/pigomatic would be displayed as "pigomatic".
    This overrides that behaviour- the corresponding value is used everywhere a title or hyperlink
    for the target is needed.

    The preferred way to use this metadata key is to name the stats target itself in a URL-friendly
    way (no punctuation or spaces, possibly all lowercase) then set the title to the properly
    spaced and punctuated project name.

* url

    The URL given here is presented on the stats browser's "information" box and in the RSS feeds.

* description

    A plaintext description of the stats target, displayed in the "information" box and RSS feeds.
    Redundant whitespace is ignored, like in HTML, but no markup language is supported.

* photo

    The default picture to associate with a stats target. This picture always appears in the stats
    browser and RSS feeds. If no icon is supplied, this photo is also used as an icon.

    The supplied image can be any size, within reason. Since CIA needs this image to be presented
    at different sizes in different output media, it maintains a thumbnail cache with rescaled
    versions of images as necessary. To use all available space in the stats browser, this image
    should be at least 250 pixels wide.

    The original image can be in any format supported by the Python Imaging Library, which includes
    GIF, JPEG, and PNG. Note that PIL doesn't support interlaced PNGs.

    The metadata key's value must be the image itself, not a path or URI.
    This means that, with stats_metadata.py, you must use the -f and -t options, with a valid mime
    type supplied to the -t option. With the web interface, set the MIME type properly and use
    the "Upload value from file" field instead of "Set value to".

    Alpha channels are supported, and their use is encouraged when appropriate.

* icon

    A simpler picture to be used as icons on lists of stats targets. Because the same automatic
    rescaling described above is used, the icon doesn't have to be small. Set the icon to whatever
    image you have handy, and CIA will automatically thumbnail this to an appropriate size. Currently
    CIA only needs one size of icon, but sticking to this guideline will ensure your project doesn't
    have a tiny icon when CIA does require larger images for other purposes.

    If no icon is supplied but a photo is supplied, the photo is used as an icon also.
    All image format guidelines for photos apply to icons.

* subtitle

    This metadata key overrides the text that appears below a project's title in the stats browser.

* related-filter

    A simple XML filter that can be used to remove unwanted or meaningless information from the 'related'
    box in the stats browser. These filters are similar to the filters used on messages by rulesets.

    This metadata key is probably not useful for projects, so the XML format isn't documented here yet :)

* links-filter

    A way to control the contents of the 'links' box in the stats browser. The fitler is made up of
    actions, each of which is a line starting with "+" or "-" followed by whitespace and a regular
    expression. "+" actions add all available links matching the regex, "-" actions remove any
    links matching the regex. The default links are RSSLink, RSSCustomizer, MetadataLink,
    and XMLLink. To disable all RSS links, for example, you could use the line "- RSS.*"

